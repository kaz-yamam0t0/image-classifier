{"version":3,"file":"main.js","sources":["../src/js/util.ts","../src/js/preview.ts","../src/js/config.ts","../src/js/connection.ts","../src/js/sources.ts","../src/js/main.ts"],"sourcesContent":["\nconst listen = function(name:string, callback) {\n\t(this || window).addEventListener(name, callback);\n};\n\n// debugger\nlet _debug = null;\nconst debug = (s:string)=>{\n\tif (_debug == null) {\n\t\t_debug = createElement(\"div\", {\"class\":\"debugger\"}, document.body);\n\t}\n\t_debug.innerHTML = s;\n};\n\n\n\nconst setAttrs = (el:any, attrs:any)=>{\n\tif (!attrs) {\n\t\treturn;\n\t}\n\tif (typeof attrs === \"string\") {\n\t\tattrs = { \"text\" : attrs };\n\t}\n\tif (attrs) {\n\t\tObject.keys(attrs).forEach((k)=>{\n\t\t\tconst v = attrs[k];\n\t\t\tif (typeof v === \"undefined\" || v === null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// style\n\t\t\tif (k == \"style\" && (typeof v === \"object\")) {\n\t\t\t\tObject.keys(v).forEach(k_=>{\n\t\t\t\t\tel.style[k_] = v[k_];\n\t\t\t\t});\n\t\t\t} \n\t\t\t// class\n\t\t\telse if (k == \"class\") {\n\t\t\t\tif (Array.isArray(v)) {\n\t\t\t\t\tv.forEach(v_=>el.classList.add(v_));\n\t\t\t\t} else if (typeof v === \"object\") {\n\t\t\t\t\tObject.keys(v).forEach(k_=>{\n\t\t\t\t\t\tif (v[k_] == true) {\n\t\t\t\t\t\t\tel.classList.add(k_);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tel.classList.remove(k_);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tv.split(/\\s+/).forEach(v_=>{\n\t\t\t\t\t\tif (v_ = v_.trim()) el.classList.add(v_);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} \n\t\t\t// text\n\t\t\telse if (k === \"text\") {\n\t\t\t\tel.textContent = v;\n\t\t\t}\n\t\t\t// default\n\t\t\telse {\n\t\t\t\tel[k] = v\n\t\t\t}\n\t\t});\t\n\t}\n};\nconst setStyle = (el:any, styles:Object)=>{\n\tsetAttrs(el, { \"style\": styles });\n};\nconst createElement = (tagName:string, attrs:any, parentNode:any=null, callback:any=null)=>{\n\tconst el = document.createElement(tagName);\n\tif (attrs) setAttrs(el, attrs);\n\n\tif (parentNode) {\n\t\tparentNode.appendChild(el)\n\t}\n\tif (callback) {\n\t\tcallback(el);\n\t}\n\treturn el;\n};\n\nconst find = (q:string, el:any=null)=>{\n\treturn (el || document).querySelector(q);\n};\nconst findByClass = (q:string, el:any=null)=>{\n\tconst elements = (el || document).getElementsByClassName(q);\n\tif (elements.length > 0) return elements[0];\n\treturn null;\n};\n\n\nexport {\n\tlisten,\n\tdebug,\n\tcreateElement, \n\tsetAttrs,\n\tsetStyle, \n\n\tfind,\n\tfindByClass,\n}","\n\nimport { listen, debug, setStyle, createElement, findByClass } from './util';\n\nclass Preview {\n\tmode = 0; // 1=moving 2=point\n\n\t// event position\n\tstartX = 0;\n\tstartY = 0;\n\tpageX = 0;\n\tpageY = 0;\n\t\n\t// image position\n\t_imageStartX = 0;\n\t_imageStartY = 0;\n\timageX = 0;\n\timageY = 0;\n\n\t// frame position\n\t_frameStartX = 0;\n\t_frameStartY = 0;\n\t_frameStartW = 0;\n\t_frameStartH = 0;\n\tframeX = 0;\n\tframeY = 0;\n\tframeWidth = 0;\n\tframeHeight = 0;\n\n\t// zoom\n\tzoom = 1;\n\n\t// image data\n\timageUrl: string;\n\timage = null; // Image\n\n\t// elements\n\tel = null; // div.preview\n\tbg = null;            // div.bg\n\tframe = null;         // div.frame\n\tframeImage = null;    // div.frame div.image\n\tframeDragger = null;  // div.frame div.dragger\n\tframePoints = [];     // [ div.point ]\n\n\t// event callbacks\n\t__mousedown = null;\n\t__mousemove = null;\n\t__mouseup = null;\n\n\t__point_mousedown = null;\n\t__point_mousemove = null;\n\t__point_mouseup = null;\n\n\t// options\n\toptions = null;\n\n\t// Sources\n\t//sources = null;\n\tdata = null;\n\n\tconstructor(image_data, options=null) {\n\t\t//this.sources = sources;\n\t\tthis.data = image_data;\n\t\tthis.imageUrl = image_data.b64 || image_data.path;\n\t\tthis.options = options;\n\t\tthis.reset();\n\t}\n\treset() {\n\t\tthis.mode = 0;\n\t\tthis.startX = this.startY = 0;\n\t\tthis.pageX = this.pageY = 0;\n\t\tthis.imageX = this.imageY = 0;\n\t\tthis._imageStartX = this._imageStartY = 0;\n\n\t\tthis._frameStartX = this._frameStartY = 0;\n\t\tthis._frameStartW = this._frameStartH = 0;\n\t\tthis.frameX = this.frameY = 0;\n\t\tthis.frameWidth = this.frameHeight = 0;\n\n\t\tthis.zoom = 1;\n\n\t\t//this.image = null;\n\t\t//this.el = null;\n\t}\n\n\tfree() {\n\t\tconst self = this;\n\n\t\t// free events\n\t\t//if (this.__mousedown) this.el.removeEventListener(\"mousedown\", this.__mousedown);\n\t\t//if (this.__mousemove) this.el.removeEventListener(\"mousemove\", this.__mousemove);\n\t\t//if (this.__mouseup) this.el.removeEventListener(\"mouseup\", this.__mouseup);\n\t\t\n\t\t//if (this.__mousedown) this.frame.removeEventListener(\"mousedown\", this.__mousedown);\n\t\t//if (this.__mousemove) this.frame.removeEventListener(\"mousemove\", this.__mousemove);\n\t\t//if (this.__mouseup) this.frame.removeEventListener(\"mouseup\", this.__mouseup);\n\n\t\tthis.framePoints.forEach(p=>{\n\t\t\tif (self.__point_mousedown) p.removeEventListener(\"mousedown\", self.__point_mousedown);\n\t\t\t//if (self.__point_mousemove) p.removeEventListener(\"mousemove\", self.__point_mousemove);\n\t\t\t//if (self.__point_mouseup) p.removeEventListener(\"mouseup\", self.__point_mouseup);\n\t\t\t//if (self.__point_mouseup) p.removeEventListener(\"mouseleave\", self.__point_mouseup);\n\t\t});\n\t\tif (self.__point_mousemove) this.frame.removeEventListener(\"mousemove\", self.__point_mousemove);\n\t\tif (self.__point_mouseup) this.frame.removeEventListener(\"mouseup\", self.__point_mouseup);\n\t\tif (self.__point_mouseup) this.frame.removeEventListener(\"mouseleave\", self.__point_mouseup);\n\n\t\t// remove elements\n\t\tthis.framePoints.forEach(p=>p.remove());\n\t\tthis.framePoints = [];\n\n\t\tif (this.frameDragger) this.frameDragger.remove();\n\t\tif (this.frameImage) this.frameImage.remove();\n\t\tif (this.frame) this.frame.remove();\n\t\tif (this.bg) this.bg.remove();\n\n\t\t// alter elements and events to NULL\n\t\tthis.__mousedown = null;\n\t\tthis.__mousemove = null;\n\t\tthis.__mouseup = null;\n\n\t\tthis.__point_mousedown = null;\n\t\tthis.__point_mousemove = null;\n\t\tthis.__point_mouseup = null;\n\n\t\tthis.el = null;\n\t\tthis.image = null;\n\t\tthis.bg = null;\n\t\tthis.frame = null;\n\t\tthis.frameImage = null;\n\t\tthis.frameDragger = null;\n\n\t\t//this.sources = null;\n\t\tthis.data = null;\n\t}\n\n\tmount() {\n\t\tif (!(this.el = findByClass(\"preview\"))) {\n\t\t\tthrow 'preview not found.';\t\t\t\n\t\t}\n\t\tthis.image = new Image();\n\t\tthis.image.src = this.imageUrl;\n\n\t\tif (this.image.complete) {\n\t\t\tthis.onload();\n\t\t} else {\n\t\t\tconst self = this;\n\t\t\tthis.image.onload = ()=>{\n\t\t\t\tself.onload();\n\t\t\t};\n\t\t\tthis.image.onerror = (err)=>{\n\t\t\t\t// @TODO\n\t\t\t};\n\t\t}\n\t}\n\tcacheBase64data() {\n\t\tconst canvas = document.createElement(\"canvas\");\n\t\tconst context = canvas.getContext(\"2d\");\n\t\tcanvas.width = this.image.width;\n\t\tcanvas.height = this.image.height;\n\t\t\n\t\tcontext.drawImage(this.image, 0,0);\n\n\t\tthis.data.b64 = canvas.toDataURL(\"image/png\");\n\t}\n\tonload() {\n\t\tconst self = this;\n\n\t\tif (this.data && !this.data.b64) {\n\t\t\tthis.cacheBase64data();\n\t\t}\n\n\t\t//this.bg = createElement(\"img\", {\n\t\t//\t\"src\" : this.imageUrl,\n\t\t//\t\"class\" : \"bg\",\n\t\t//}, this.el);\n\t\tthis.bg = createElement(\"div\", {\"class\" : \"bg\"}, this.el);\n\t\tcreateElement(\"img\", { \"src\" : this.imageUrl }, this.bg);\n\n\t\tthis.frame = createElement(\"div\", {\"class\": \"frame\"}, this.el);\n\t\t\n\t\tthis.frameDragger = createElement(\"div\", {\"class\": \"dragger\"} , this.frame);\n\t\t//this.frameImage = createElement(\"img\", {\n\t\t//\t\"src\" : this.imageUrl,\n\t\t//}, this.frame);\n\t\tthis.frameImage = createElement(\"div\", {\"class\":\"image\"}, this.frame);\n\t\tcreateElement(\"img\", { \"src\": this.imageUrl } , this.frameImage);\n\n\t\t[\"ne\",\"nw\",\"sw\",\"se\"].forEach((dir)=>{\n\t\t\tconst el = createElement(\"div\", {\"class\" : ['point',`-${dir}`] }, self.frame);\n\t\t\tself.framePoints.push(el);\n\t\t});\n\n\t\t// calculate ratio\n\t\tlet w0 = this.el.clientWidth, \n\t\t\th0 = this.el.clientHeight, \n\t\t\tw = this.image.width, \n\t\t\th = this.image.height;\n\t\t\n\t\tlet r = 1;\n\t\t// zoom == 1\n\t\t/*\n\t\tif (w > w0) {\n\t\t\tr = Math.min(r, w0 / w);\n\t\t\tw *= r; h *= r;\n\t\t}\n\t\tif (h > h0) {\n\t\t\tr = Math.min(r, h0 / h);\n\t\t\tw *= r; h *= r;\n\t\t}\n\t\t*/\n\n\t\t// initialize image size and position\n\t\tthis.zoom = r;\n\t\tthis.imageX = (w0 - this.image.width * r) / 2;\n\t\tthis.imageY = (h0 - this.image.height * r) / 2;\n\t\t\n\t\t// calculate frame position\n\t\tthis.frameWidth = this.image.width; // * r;\n\t\tthis.frameHeight = this.image.height; // * r;\n\t\tthis.frameX = this.imageX;\n\t\tthis.frameY = this.imageY;\n\t\t\n\t\tif (this.data && this.data.frame) {\n\t\t\t// maintain frame size/position\n\t\t\tthis.frameWidth = this.data.frame.width;\n\t\t\tthis.frameHeight = this.data.frame.height;\n\t\t\tthis.frameX = this.imageX + this.data.frame.x;\n\t\t\tthis.frameY = this.imageY + this.data.frame.y;\n\t\t} else {\n\t\t\t// adjust \n\t\t\t// adjust ratio\n\t\t\tif (this.options && this.options.image_size) {\n\t\t\t\tlet [_w_, _h_] = this.options.image_size;\n\t\t\t\tif (_w_ > 0 && _h_ > 0) {\n\t\t\t\t\tconst r_ = _w_ / _h_;\n\t\t\t\t\tlet [w, h] = [this.frameWidth, this.frameHeight];\n\t\t\t\t\t_w_ = h * r_;\n\t\t\t\t\t_h_ = w / r_;\n\t\t\t\t\tif (w > _w_) {\n\t\t\t\t\t\tw = _w_;\n\t\t\t\t\t} else if (h > _h_) {\n\t\t\t\t\t\th = _h_;\n\t\t\t\t\t}\n\t\t\t\t\tthis.frameWidth = w;\n\t\t\t\t\tthis.frameHeight = h;\n\t\t\t\t\tthis.frameX = this.imageX + (this.image.width - w) / 2;\n\t\t\t\t\tthis.frameY = this.imageY + (this.image.width - h) / 2;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// save data\n\t\tif (this.data) {\n\t\t\tthis.data.frame = {\n\t\t\t\tx: this.frameX - this.imageX, \n\t\t\t\ty: this.frameY - this.imageY,\n\t\t\t\twidth: this.frameWidth, \n\t\t\t\theight: this.frameHeight,\n\t\t\t};\n\t\t}\n\n\t\t// update \n\t\tthis.update();\n\n\t\t// init events\n\t\tthis.initEvents();\n\t}\n\tupdate() {\n\t\tif (this.bg) {\n\t\t\tsetStyle(this.bg, {\n\t\t\t\t\"left\" : `${this.imageX}px`,\n\t\t\t\t\"top\" : `${this.imageY}px`,\n\t\t\t\t//\"width\" : `${this.image.width * this.zoom}px`,\n\t\t\t\t//\"height\" : `${this.image.height * this.zoom}px`,\n\t\t\t\t\"width\" : `${this.image.width}px`,\n\t\t\t\t\"height\" : `${this.image.height}px`,\n\t\t\t\t\"transform\" : `scale(${this.zoom})`,\n\t\t\t\t\"transform-origin\" : \"center center\",\n\t\t\t});\n\t\t}\n\t\tif (this.frame) {\n\t\t\tsetStyle(this.frame, {\n\t\t\t\t\"left\" : `${this.frameX}px`,\n\t\t\t\t\"top\" : `${this.frameY}px`,\n\t\t\t//\t\"width\" : `${this.frameWidth * this.zoom}px`,\n\t\t\t//\t\"height\" : `${this.frameHeight * this.zoom}px`,\n\t\t\t\t\"width\" : `${this.frameWidth}px`,\n\t\t\t\t\"height\" : `${this.frameHeight}px`,\n\t\t\t\t\"transform\" : `scale(${this.zoom})`,\n\t\t\t\t\"transform-origin\" : \"center center\",\n\t\t\t});\n\t\t}\n\t\tif (this.bg && this.frame && this.frameImage) {\n\t\t\tconst x = this.imageX - this.frameX;\n\t\t\tconst y = this.imageY - this.frameY;\n\n\t\t\tsetStyle(this.frameImage, {\n\t\t\t\t\"left\" : `${x}px`,\n\t\t\t\t\"top\" : `${y}px`,\n\t\t\t//\t\"width\" : `${this.image.width * this.zoom}px`,\n\t\t\t//\t\"height\" : `${this.image.height * this.zoom}px`,\n\t\t\t\t\"width\" : `${this.image.width}px`,\n\t\t\t\t\"height\" : `${this.image.height}px`,\n\t\t\t\t\"transform\" : `scale(${this.zoom})`,\n\t\t\t\t\"transform-origin\" : \"center center\",\n\t\t\t});\n\t\t}\n\t}\n\n\t// event\n\tinitEvents() {\n\t\tconst self = this;\n\n\t\tthis.__mousedown = (e)=>{\n\t\t\tself.dragMousedown(e);\n\t\t\t//return false;\n\t\t};\n\t\tthis.__mousemove = (e)=>{\n\t\t\tif (self.mode != 1) return;\n\t\t\tself.dragMousemove(e);\n\t\t\t//return false;\n\t\t};\n\t\tthis.__mouseup = (e)=>{\n\t\t\tif (self.mode != 1) return;\n\t\t\tself.dragMouseup(e);\n\t\t\t//return false;\n\t\t};\n\t\tlisten.call(this.frameDragger, \"mousedown\", this.__mousedown);\n\t\tlisten.call(this.frameDragger, \"mousemove\", this.__mousemove);\n\t\tlisten.call(this.frameDragger, \"mouseup\", this.__mouseup);\n\n\n\t\tlet p = null;\n\t\t\n\t\tthis.__point_mousedown = function(e) {\n\t\t\tp = this;\n\n\t\t\t//e.preventDefault();\n\t\t\t//e.stopPropagation();\n\t\t\tself.pointMousedown(e, this);\n\t\t\t//return false;\n\t\t};\n\t\tthis.__point_mousemove = function(e) {\n\t\t\tif (self.mode != 2) return;\n\t\t\tif (!p) return;\n\n\t\t\t//e.preventDefault();\n\t\t\t//e.stopPropagation();\n\t\t\t//self.pointMousemove(e, this);\n\t\t\tself.pointMousemove(e, p);\n\t\t\t//return false;\n\t\t};\n\t\tthis.__point_mouseup = function(e) {\n\t\t\tif (self.mode != 2) return;\n\t\t\tif (!p) return;\n\n\t\t\t//e.preventDefault();\n\t\t\t//e.stopPropagation();\n\t\t\t//self.pointMouseup(e, this);\n\t\t\tself.pointMouseup(e, p);\n\t\t\tp = null;\n\t\t\t//return false;\n\t\t};\n\t\tthis.framePoints.forEach(p=>{\n\t\t\tlisten.call(p, \"mousedown\", self.__point_mousedown);\n\t\t\t//listen.call(p, \"mousemove\", self.__point_mousemove);\n\t\t\t//listen.call(p, \"mouseup\", self.__point_mouseup);\n\t\t\t//listen.call(p, \"mouseleave\", self.__point_mouseup);\n\t\t});\n\t\tlisten.call(this.el, \"mousemove\", this.__point_mousemove);\n\t\tlisten.call(this.el, \"mouseup\", this.__point_mouseup);\n\t\tlisten.call(this.el, \"mouseleave\", this.__point_mouseup);\n\t}\n\tmove(x:number, y:number, x2:number=null, y2:number=null) {\n\t\tif (x2 === null) x2 = x + this.frameWidth;\n\t\tif (y2 === null) y2 = y + this.frameHeight;\n\t\tif (x > x2) {\n\t\t\tconst tmp = x;\n\t\t\tx = x2;\n\t\t\tx2 = tmp;\n\t\t}\n\t\tif (y > y2) {\n\t\t\tconst tmp = y;\n\t\t\ty = y2;\n\t\t\ty2 = tmp;\n\t\t}\n\t\tx = Math.max(x, this.imageX);\n\t\ty = Math.max(y, this.imageY);\n\t\tx2 = Math.min(x2, this.imageX + this.image.width);\n\t\ty2 = Math.min(y2, this.imageY + this.image.height);\n\n\t\tthis.frameX = x;\n\t\tthis.frameY = y;\n\n\t\tthis.frameWidth = Math.max(24, x2 - x);\n\t\tthis.frameHeight = Math.max(24, y2 - y);\n\n\t\tif (this.data) {\n\t\t\tthis.data.frame = {\n\t\t\t\tx: x - this.imageX, \n\t\t\t\ty: y - this.imageY,\n\t\t\t\twidth: this.frameWidth, \n\t\t\t\theight: this.frameHeight,\n\t\t\t};\n\t\t\tthis.data.changed = true;\n\t\t}\n\t}\n\tdragMousedown(e) {\n\t\tthis.mode = 1;\n\t\tthis.pageX = this.startX = e.pageX;\n\t\tthis.pageY = this.startY = e.pageY;\n\t\t//[this._imageStartX, this._imageStartY] = [this.imageX, this.imageY];\n\t\t[this._frameStartX, this._frameStartY] = [this.frameX, this.frameY];\n\t\t[this._frameStartW, this._frameStartH] = [this.frameWidth, this.frameHeight];\n\t\tthis.update();\n\t\tthis._debug();\n\t}\n\tdragMousemove(e) {\n\t\tif (this.mode != 1) return;\n\n\t\tlet [x,y,w,h] = [this._frameStartX, this._frameStartY, this._frameStartW, this._frameStartH];\n\t\tlet [x2,y2] = [x+w, y+h];\n\n\t\t[this.pageX, this.pageY] = [e.pageX, e.pageY];\n\t\tconst dx = (this.pageX - this.startX);// / this.zoom;\n\t\tconst dy = (this.pageY - this.startY);// / this.zoom;\n\t\tx += dx; y += dy;\n\t\tx2 += dx; y2 += dy;\n\t\tif (x < this.imageX) { [x,x2] = [this.imageX,this.imageX+w]; }\n\t\tif (y < this.imageY) { [y,y2] = [this.imageY,this.imageY+h]; }\n\n\t\tif (this.imageX + this.image.width < x2) { \n\t\t\tx2 = this.imageX + this.image.width;\n\t\t\tx = x2 - w;\n\t\t}\n\t\tif (this.imageY + this.image.height < y2) {\n\t\t\ty2 = this.imageY + this.image.height;\n\t\t\ty = y2 - h;\n\t\t}\n\n\t\tthis.move(x,y,x2,y2);\n\t\tthis.update();\n\t\tthis._debug();\n\t}\n\tdragMouseup(e) {\n\t\tif (this.mode != 1) return;\n\n\t\tthis.mode = 0;\n\t\tthis.pageX = this.startX = 0;\n\t\tthis.pageY = this.startY = 0;\n\t\tthis._frameStartX = this._frameStartY = 0;\n\t\tthis._frameStartW = this._frameStartH = 0;\n\t}\n\n\tpointMousedown(e, p) {\n\t\tp.classList.add(\"-active\");\n\n\t\tthis.mode = 2;\n\t\tthis.pageX = this.startX = e.pageX;\n\t\tthis.pageY = this.startY = e.pageY;\n\t\t//[this._imageStartX, this._imageStartY] = [this.imageX, this.imageY];\n\t\t[this._frameStartX, this._frameStartY] = [this.frameX, this.frameY];\n\t\t[this._frameStartW, this._frameStartH] = [this.frameWidth, this.frameHeight];\n\t\tthis.update();\n\t\tthis._debug();\n\t}\n\n\tpointMousemove(e, p) {\n\t\tif (this.mode != 2) return;\n\n\t\tlet [x,y,w,h] = [this._frameStartX, this._frameStartY, this._frameStartW, this._frameStartH];\n\t\tlet [x2,y2] = [x+w, y+h];\n\n\t\t[this.pageX, this.pageY] = [e.pageX, e.pageY];\n\t\tconst dx = (this.pageX - this.startX);// / this.zoom;\n\t\tconst dy = (this.pageY - this.startY);// / this.zoom;\n\t\tlet inversion_x = false;\n\t\tlet inversion_y = false;\n\n\t\tlet n_ = false, s_ = false, e_ = false, w_ = false;\n\t\tif (p.classList.contains(\"-ne\")) {\n\t\t\tn_ = e_ = true;\n\t\t} else if (p.classList.contains(\"-nw\")) {\n\t\t\tn_ = w_ = true;\n\t\t} else if (p.classList.contains(\"-se\")) {\n\t\t\ts_ = e_ = true;\n\t\t} else if (p.classList.contains(\"-sw\")) {\n\t\t\ts_ = w_ = true;\n\t\t}\n\t\tif (n_) y += dy;\n\t\telse if (s_) y2 += dy;\n\n\t\tif (e_) x += dx;\n\t\telse if (w_) x2 += dx;\n\n\t\tif (x > x2) {\n\t\t\tinversion_x = true;\n\t\t\t[x,x2] = [x2,x];\n\t\t}\n\t\tif (y > y2) {\n\t\t\tinversion_y = true;\n\t\t\t[y,y2] = [y2,y];\n\t\t}\n\n\t\tif (x2 - x < 24) x2 = x + 24;\n\t\tif (y2 - y < 24) y2 = y + 24;\n\n\t\tx = Math.min(Math.max(x, this.imageX), this.imageX + this.image.width);\n\t\ty = Math.min(Math.max(y, this.imageY), this.imageY + this.image.height);\n\t\tx2 = Math.min(Math.max(x2, this.imageX), this.imageX + this.image.width);\n\t\ty2 = Math.min(Math.max(y2, this.imageY), this.imageY + this.image.height);\n\n\t\t// adjust ratio\n\t\tif (this.options && this.options.image_size) {\n\t\t\tlet [_w_, _h_] = this.options.image_size;\n\t\t\tif (_w_ > 0 && _h_ > 0) {\n\t\t\t\tconst r_ = _w_ / _h_;\n\t\t\t\tw = x2 - x;\n\t\t\t\th = y2 - y;\n\t\t\t\t_w_ = h * r_;\n\t\t\t\t_h_ = w / r_;\n\t\t\t\tif (w > _w_) {\n\t\t\t\t\tw = _w_;\n\t\t\t\t} else if (h > _h_) {\n\t\t\t\t\th = _h_;\n\t\t\t\t}\n\t\t\t\tif (e_ || (w_ && inversion_x)) x = x2 - w;\n\t\t\t\telse if (w_ || (e_ && inversion_x)) x2 = x + w;\n\n\t\t\t\tif (n_ || (s_ && inversion_y)) y = y2 - h;\n\t\t\t\telse if (s_ || (n_ && inversion_y)) y2 = y + h;\n\n\t\t\t\ty2 = y + h;\n\t\t\t}\n\t\t}\n\n\t\tthis.move(x,y,x2,y2);\n\t\tthis.update();\n\t\tthis._debug();\n\t}\n\tpointMouseup(e, p) {\n\t\tif (this.mode != 2) return;\n\t\tthis.mode = 0;\n\t\tthis.pageX = this.startX = 0;\n\t\tthis.pageY = this.startY = 0;\n\t\tthis._frameStartX = this._frameStartY = 0;\n\t\tthis._frameStartW = this._frameStartH = 0;\n\n\t\tp.classList.remove(\"-active\");\n\t\tthis.framePoints.forEach(p=>p.classList.remove(\"-active\"))\n\t}\n\n\t_debug() {\n\t\t/*\n\t\tdebug(`\n\t\t\tmode: ${this.mode}<br />\n\t\t\tstart: (${this.startX}, ${this.startY})<br />\n\t\t\tpageX/Y: (${this.pageX}, ${this.pageY})<br />\n\t\t\timage: pos=(${this.imageX}, ${this.imageY}) size=(${this.image.width}, ${this.image.height})<br />\n\t\t\tframe: pos=(${this.frameX}, ${this.frameY}) size=(${this.frameWidth}, ${this.frameHeight})<br />\n\t\t\tzoom: ${this.zoom}\n\t\t`);\n\t\t*/\n\t}\n}\nexport default Preview;\n","\nconst DATA_DIR = 'data';\nconst CONNECTION_URL = 'http://localhost:8080';\nconst CONNECTION_INTERVAL_T = 2000;\nexport {\n\tDATA_DIR,\n\tCONNECTION_URL,\n\tCONNECTION_INTERVAL_T,\n};","\nimport { listen, debug, setStyle, createElement, findByClass } from './util';\nimport { DATA_DIR, CONNECTION_URL, CONNECTION_INTERVAL_T } from './config';\n\n\nlet instance = null;\n\nclass Connection {\n\tconnected:boolean = false;\n\tel: any; \n\n\tconstructor() {\n\t\tthis.mount();\n\t\t// this.showError();\n\t}\n\n\tmount() {\n\t\tthis.el = createElement(\"div\", {\"class\": \"global-error\"}, document.body);\n\t\tthis.el.style.display = \"none\";\n\t}\n\t_observe(callback, error) {\n\t\tlet has_called = false;\n\t\tlet has_errored = false;\n\n\t\tconst self = this;\n\t\tconst done = ()=>{\n\t\t\tsetTimeout(()=>{\n\t\t\t\treq();\n\t\t\t}, CONNECTION_INTERVAL_T);\n\t\t};\n\t\tconst req = ()=>{\n\t\t\tself._connect((...args)=>{\n\t\t\t\tif (has_errored) { \n\t\t\t\t\t// reload when reconnected\n\t\t\t\t\tlocation.reload();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (has_called == false) {\n\t\t\t\t\tcallback.apply(null, args);\n\t\t\t\t\thas_called = true;\n\t\t\t\t}\n\t\t\t\tself.connected = true;\n\t\t\t\tdone();\n\t\t\t}, (err)=> {\n\t\t\t\thas_errored = true;\n\n\t\t\t\tif (error) error(err);\n\t\t\t\tdone();\n\t\t\t});\n\t\t};\n\t\treq();\n\t}\n\t_connect(callback=null, error=null) {\n\t\tif (this._isLocal()) {\n\t\t\tlocation.href = `${CONNECTION_URL}/`;\n\t\t\treturn;\n\t\t}\n\n\t\tconst self = this;\n\n\t\treturn this._request(\"/status\")\n\t\t\t.then(response=>{\n\t\t\t\tif (callback) callback.call(null, this);\n\t\t\t})\n\t\t\t.catch((err)=>{\n\t\t\t\t// if (callback) callback.call(null, null, err);\n\t\t\t\tif (error) error.call(null, err);\n\n\t\t\t\tself.connected = false;\n\t\t\t\tself.showError();\n\t\t\t});\n\t}\n\t_request(url:string, method:string=\"GET\", data:any=null, complete=null) {\n\t\tlet o = { method }\n\t\tif (method == \"POST\") {\n\t\t\to[\"headers\"] = {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// 'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t}\n\t\t\to[\"body\"] = JSON.stringify(data);\n\t\t} \n\t\t//console.log(url, o);\n\t\tconst p = fetch(this._path(url), o);\n\t\t\n\t\tif (complete) {\n\t\t\tp.then((res)=>{\n\t\t\t\tres.json().then(data=>{\n\t\t\t\t\tcomplete(data);\n\t\t\t\t\treturn data;\n\t\t\t\t});\n\t\t\t\treturn res;\n\t\t\t});\n\t\t}\n\t\t\n\n\t\treturn p;\n\t}\n\t_get(url:string, complete=null) {\n\t\treturn this._request(url, \"GET\", null, complete);\n\t}\n\t_post(url:string, data:any=null, complete=null) {\n\t\treturn this._request(url, \"POST\", data, complete);\n\t}\n\n\n\t_path(url:string) {\n\t\tif (url.indexOf(\"://\") >= 0 || url.indexOf(\"//\") === 0) {\n\t\t\treturn url;\n\t\t}\n\t\tif (url[0] != \"/\") url = `/${url}`;\n\n\t\treturn CONNECTION_URL + url + '?' + (new Date()).getTime();\n\t}\t\n\t_isLocal() {\n\t\tif (! location || !location.protocol || location.protocol == \"file:\") {\n\t\t\treturn true;\n\t\t}\n\t\tif (location.protocol != \"http:\" && location.protocol != \"https://\") {\n\t\t\treturn true;\n\t\t}\n\t\tif (!location.hostname || `${location.hostname}`.trim() == \"\") {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tshowError() {\n\t\tif (!this.el) return;\n\n\t\tthis.el.innerHTML = 'Connection failed. Make sure app.py server is runnning. <code>$ python app.py</code>.';\n\t\tthis.el.style.display = \"block\";\t\t\n\t}\n\thideError() {\n\t\tif (!this.el) return;\n\t\t\n\t\tthis.el.style.display = \"none\";\n\t}\n\n\tstatic connect(callback, error=null) {\n\t\tif (! instance) {\n\t\t\tinstance = new Connection();\n\t\t\tinstance._observe(callback, error);\n\t\t} else {\n\t\t\tif (instance.connected) {\n\t\t\t\tif (callback) callback.call(null, instance);\n\t\t\t} else {\n\t\t\t\tinstance._observe(callback, error);\n\t\t\t}\n\t\t}\n\t\treturn instance;\n\t}\n\tstatic isConnected() {\n\t\tif (! instance) {\n\t\t\treturn false;\n\t\t}\n\t\treturn instance.connected;\n\t}\n}\n\nexport default Connection;\n","import { listen, debug, setStyle, createElement, findByClass } from './util';\nimport { DATA_DIR } from './config';\n\nimport Connection from './connection';\n\nclass Sources {\n\toptions = null;\n\n\titems: {\n\t\tname: string, \n\t\tpath_org: string,\n\t\tpath: string, \n\t\ttag: string,\n\n\t\tdone: boolean,\n\t\tremoved: boolean,\n\t\tchanged: boolean,\n\n\t\tb64: string, // cache base64 image data for reference after renaming images\n\n\t\t$li: any, // <li>\n\t\t$image: any, // <img>\n\t\tframe: null, // {x,y,width,height}\n\t}[];\n\n\tel = null; // div.sources\n\tul = null; // <ul>\n\n\tcurrent:number = 0; // item of this.items \n\tmounted:boolean = false;\n\tonchange = null;\n\tonupdate = null;\n\n\tconstructor(items: any[], options=null) {\n\t\tconst self = this;\n\t\tthis.options = options;\n\n\t\tthis.items = [];\n\t\tthis.add(items);\n\t}\n\treplace(items: any[]) {\n\t\tthis.items = [];\n\t\tthis.ul.innerHTML = \"\";\n\t\tthis.current = 0;\n\t\t\n\t\tthis.add(items);\n\t}\n\tadd(items: any[]) {\n\t\tconst self = this;\n\n\t\titems.forEach((item)=>{\n\t\t\tif (typeof item === \"string\") {\n\t\t\t\titem = { \n\t\t\t\t\tname: item,  \n\t\t\t\t\tpath_org: `${DATA_DIR}/${item}`,\n\t\t\t\t\tpath: `${DATA_DIR}/${item}`,\n\t\t\t\t\ttag: null,\n\n\t\t\t\t\tdone: false,\n\t\t\t\t\tremoved: false,\n\t\t\t\t\tchanged: false, \n\t\t\t\t};\n\t\t\t\titem.$image = new Image();\n\t\t\t\titem.$image.src = item.path;\n\t\t\t}\n\t\t\tself.items.push(item);\n\t\t});\n\n\t\tif (this.mounted) {\n\t\t\tthis.update();\n\t\t\tthis.change();\n\t\t}\n\t}\n\n\tmount() {\n\t\tif (!(this.el = findByClass(\"sources\"))) {\n\t\t\tthrow '`.sources` not found.';\t\t\t\n\t\t}\n\t\tif (!(this.ul = this.el.querySelector(\"ul\"))) {\n\t\t\t// throw '`.sources > ul` not found.';\t\n\t\t\tthis.ul = createElement(\"ul\", null, this.el);\n\t\t}\n\n\t\tthis.mounted = true;\n\n\t\tthis.update();\n\t\tthis.initEvents();\n\n\t\tthis.change();\n\t}\n\tupdate() {\n\t\tconst self = this;\n\t\tthis.items.forEach((item, index)=>{\n\t\t\t// $li\n\t\t\tlet $li = item.$li = item.$li || createElement(\"li\",null, self.ul);\n\t\t\t//$li.setAttribute(\"title\", item.path);\n\n\t\t\t// $item\n\t\t\tlet $item = findByClass(\"item\", $li) || createElement(\"div\", { \"class\":\"item\" }, $li);\n\t\t\tlet $image = findByClass(\"image\", $item) || createElement(\"div\", {\"class\":\"image\"}, $item, (el)=>{\n\t\t\t\tel.appendChild(item.$image);\n\t\t\t});\n\t\t\tlet $name = findByClass(\"name\", $item) || createElement(\"div\", {\"class\":\"name\"}, $item);\n\t\t\t\n\t\t\t$name.textContent = item.name;\n\n\t\t\tif (self.current == index) {\n\t\t\t\t$item.classList.add(\"-active\");\n\t\t\t} else {\n\t\t\t\t$item.classList.remove(\"-active\");\n\t\t\t}\n\n\t\t\t// click\n\t\t\t//listen.call($li, \"click\", function(e) {\n\t\t\t//\tself.click(e);\n\t\t\t//});\n\n\t\t\t// status\n\t\t\tif (item.done) {\n\t\t\t\t$li.classList.add(\"-ok\");\n\t\t\t\t$li.classList.remove(\"-removed\");\n\t\t\t} else if (item.removed) {\n\t\t\t\t$li.classList.remove(\"-ok\");\n\t\t\t\t$li.classList.add(\"-removed\");\n\t\t\t} else {\n\t\t\t\t$li.classList.remove(\"-ok\");\n\t\t\t\t$li.classList.remove(\"-removed\");\n\t\t\t}\n\t\t});\n\t}\n\t// event\n\tinitEvents() {\n\t\tconst self = this;\n\n\t\tlisten.call(document.body, \"keydown\", (e)=>{\n\t\t\tconst keycode = e.keyCode;\n\t\t\tconst keyname = `${e.key}`.toLowerCase();\n\t\n\t\t\tif ( (keycode == 40 || keyname == 'arrowdown') || \n\t\t\t\t(keycode == 38 || keyname == 'arrowup')) \n\t\t\t{\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t\t\n\t\t\tself.keypress(e);\n\t\t\treturn false;\n\t\t});\n\t\tlisten.call(this.ul, \"click\", function(e){\n\t\t\tself.click(e);\n\t\t})\n\t}\n\tkeypress(e) {\n\t\tconst keycode = e.keyCode;\n\t\tconst keyname = `${e.key}`.toLowerCase();\n\t\t//console.log(keycode, keyname);\n\t\t\n\t\t// down\n\t\tif (keycode == 40 || keyname == 'arrowdown') {\n\t\t\tthis.moveToDown();\n\t\t}\n\t\t// up\n\t\tif (keycode == 38 || keyname == 'arrowup') {\n\t\t\tthis.moveToUp();\n\t\t}\n\t\t// delete\n\t\tif (keycode == 8 || keyname == \"backspace\") {\n\t\t\tthis.remove();\n\t\t}\n\t\t// enter\n\t\tif (keycode == 13 || keyname == 'enter') {\n\t\t\tthis.approve();\n\t\t}\n\t}\n\tclick(e) {\n\t\t// console.log(e);\n\t\tif (! e.path) {\n\t\t\treturn;\n\t\t}\n\t\tconst li = e.path.find(el_=>{\n\t\t\tif (el_.nodeType != Node.ELEMENT_NODE) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn (`${el_.nodeName}`.toLowerCase() == \"li\");\n\t\t});\n\t\tif (li.classList.contains(\"-active\")) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tconst index = this.items.findIndex((item)=>{\n\t\t\treturn (item.$li == li);\n\t\t});\n\t\tif (index >= 0) {\n\t\t\tthis.current = index;\n\t\t}\n\n\t\tthis.update();\n\t\tthis.change();\n\t\t//this.scroll();\n\t}\n\tremove() {\n\t\tif (! Connection.isConnected()) {\n\t\t\tthis.moveToDown();\n\t\t\treturn;\n\t\t}\n\t\tif (typeof this.items[this.current] !== \"undefined\") {\n\t\t\tconst current = this.items[this.current];\n\n\t\t\t// already\n\t\t\tif (current.removed) {\n\t\t\t\tthis.update();\n\t\t\t\tthis.moveToDown();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcurrent.done = false;\n\t\t\tcurrent.changed = false;\n\t\t\tcurrent.removed = true;\n\n\t\t\tif (this.onupdate) {\n\t\t\t\tthis.onupdate(current);\n\t\t\t}\n\t\t\tConnection.connect((conn)=>{\n\t\t\t\tconn._request(\"/update\", \"POST\", {\n\t\t\t\t\t\"name\": current.name,\n\t\t\t\t\t\"src\" : current.path, \n\t\t\t\t\t\"action\" : \"remove\",\n\t\t\t\t\t\"frame\" : current.frame || null,\n\t\t\t\t}).then(res=>{\n\t\t\t\t\tres.json().then(data=>{\n\t\t\t\t\t\tif (data.backup) {\n\t\t\t\t\t\t\tcurrent.path = data.backup;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\tthis.update();\n\t\tthis.moveToDown();\n\t}\n\tapprove() {\n\t\tif (! Connection.isConnected()) {\n\t\t\tthis.moveToDown();\n\t\t\treturn;\n\t\t}\n\t\tif (typeof this.items[this.current] !== \"undefined\") {\n\t\t\tconst current = this.items[this.current];\n\t\t\t\n\t\t\t// already\n\t\t\tif (current.done && !current.changed) {\n\t\t\t\tthis.update();\n\t\t\t\tthis.moveToDown();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcurrent.done = true;\n\t\t\tcurrent.changed = false;\n\t\t\tcurrent.removed = false;\n\n\t\t\tif (this.onupdate) {\n\t\t\t\tthis.onupdate(current);\n\t\t\t}\n\t\t\tConnection.connect((conn)=>{\n\t\t\t\tconn._request(\"/update\", \"POST\", {\n\t\t\t\t\t\"name\": current.name,\n\t\t\t\t\t\"src\" : current.path, \n\t\t\t\t\t\"action\" : \"ok\",\n\t\t\t\t\t\"frame\" : current.frame || null,\n\t\t\t\t}).then(res=>{\n\t\t\t\t\tres.json().then(data=>{\n\t\t\t\t\t\tif (data.backup) {\n\t\t\t\t\t\t\tcurrent.path = data.backup;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.update();\n\t\tthis.moveToDown();\n\t}\n\tmoveToUp() {\n\t\tif (this.items.length <= 0) {\n\t\t\tthis.current = 0;\n\t\t} else {\n\t\t\t//this.current = (this.current + this.items.length - 1) % this.items.length;\n\t\t\tif (this.current > 0) this.current--;\n\t\t}\n\t\tthis.update();\n\t\tthis.change();\n\t\tthis.scroll();\n\t}\n\tmoveToDown() {\n\t\tif (this.items.length <= 0) {\n\t\t\tthis.current = 0;\n\t\t} else {\n\t\t\t// this.current = (this.current + 1) % this.items.length;\n\t\t\tif (this.current < this.items.length - 1) this.current++;\n\t\t}\n\t\tthis.update();\n\t\tthis.change();\n\t\tthis.scroll();\n\t}\n\tscroll() {\n\t\t//this.el;\n\t\tif (typeof this.items[this.current] !== \"undefined\") {\n\t\t\tlet scrollTop = this.el.scrollTop;\n\t\t\tconst height0 = this.el.clientHeight;\n\t\t\tconst innerHeight = this.el.querySelector(\"ul\").clientHeight;\n\t\t\tif (height0 - 24 > innerHeight) {\n\t\t\t\t//return;\n\t\t\t}\n\n\t\t\tconst current = this.items[this.current];\n\t\t\tconst rect = current.$li.getBoundingClientRect();\n\t\t\tconst top = rect.top;\n\t\t\tconst height = rect.height;\n\n\t\t\tconst top_ = (scrollTop + top) - (height0 - height)/2; // top should be\n\n\t\t\t//if (Math.abs(top - top_) > 24) {\n\t\t\t\tthis.el.scrollTo(0, top_);\n\t\t\t//}\n\t\t}\n\t}\n\n\tchange() {\n\t\tif (typeof this.items[this.current] !== \"undefined\") {\n\t\t\tif (this.onchange) {\n\t\t\t\tthis.onchange.call(this, this.items[this.current]);\n\t\t\t}\n\t\t}\n\t}\n\n}\nexport default Sources;\n","\n\nimport { listen, debug, setStyle, find, findByClass } from './util';\n//import Layout from './layout';\nimport Preview from './preview';\nimport Sources from './sources';\nimport Connection from './connection';\n\n// reset events\nconst __return_false = ()=>false;\nlisten(\"wheel\", __return_false);\n//listen(\"click\", __return_false);\n//listen(\"mousedown\", __return_false);\n//listen(\"mousemove\", __return_false);\n//listen(\"mouseup\", __return_false);\n\n//const layout = new Layout();\n//layout.observe();\n\n// connect\nConnection.connect((conn)=>{\n\tif (! conn) return;\n\n\tlet options = null;\n\n\t// config\n\tconn._get(\"/config\", data=>{\n\t\toptions = data.options;\n\n\t\t// list\n\t\tconn._get(\"/list\",data=>{\n\t\t\tlet preview = null;\n\t\t\t\n\t\t\tif (!data[\"sources\"] || data[\"sources\"].length <= 0) {\n\t\t\t\talert(\"No images found in `data` directory.\");\n\t\t\t\tdata[\"sources\"] = [];\n\t\t\t}\n\n\t\t\tconst s = new Sources(data[\"sources\"], options);\n\t\t\ts.onchange = function(item) {\n\t\t\t\t// remount preview\n\t\t\t\tif (preview) {\n\t\t\t\t\tpreview.free();\n\t\t\t\t\tpreview = null;\n\t\t\t\t}\n\t\t\t\tpreview = new Preview(item, options);\n\t\t\t\tpreview.mount();\n\t\t\t};\n\t\t\ts.onupdate = function(item) {\n\t\t\t\t// item.removed\n\t\t\t\t// item.done\n\t\t\t};\n\t\t\ts.mount();\n\t\t\t\n\n\t\t\t// reload\n\t\t\tlet reloading = false;\n\t\t\tconst reload = findByClass(\"reload\");\n\n\t\t\tif (reload) {\n\t\t\t\treload.addEventListener(\"click\", ()=>{\n\t\t\t\t\treload.classList.add(\"-loading\");\n\t\t\t\t\tconn._get(\"/list\",data=>{\n\t\t\t\t\t\treload.classList.remove(\"-loading\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!data[\"sources\"] || data[\"sources\"].length <= 0) {\n\t\t\t\t\t\t\talert(\"No images found in `data` directory.\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\t\n\n\t\t\t\t\t\tif (preview) {\n\t\t\t\t\t\t\tpreview.free();\n\t\t\t\t\t\t\tpreview = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ts.replace(data[\"sources\"]);\n\t\t\t\t\t});\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\treload.blur();\n\t\t\t\t\t} catch(ignore_) {}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n});\n\n"],"names":["listen","name","callback","this","window","addEventListener","setAttrs","el","attrs","text","Object","keys","forEach","k","v","k_","style","Array","isArray","v_","classList","add","remove","split","trim","textContent","setStyle","styles","createElement","tagName","parentNode","document","appendChild","findByClass","q","elements","getElementsByClassName","length","image_data","options","data","imageUrl","b64","path","reset","Preview","mode","startX","startY","pageX","pageY","imageX","imageY","_imageStartX","_imageStartY","_frameStartX","_frameStartY","_frameStartW","_frameStartH","frameX","frameY","frameWidth","frameHeight","zoom","self","framePoints","p","__point_mousedown","removeEventListener","__point_mousemove","frame","__point_mouseup","frameDragger","frameImage","bg","__mousedown","__mousemove","__mouseup","image","Image","src","complete","onload","self_1","onerror","err","canvas","context","getContext","width","height","drawImage","toDataURL","cacheBase64data","class","dir","push","w0","clientWidth","h0","clientHeight","x","y","image_size","_a","_w_","_h_","r_","_b","w_1","h_1","update","initEvents","left","top","transform","e","dragMousedown","dragMousemove","dragMouseup","call","pointMousedown","pointMousemove","pointMouseup","x2","y2","tmp","Math","max","min","changed","_debug","_d","w","h","_e","dx","dy","_c","move","inversion_x","inversion_y","n_","s_","e_","w_","contains","_f","DATA_DIR","CONNECTION_URL","instance","mount","Connection","body","display","error","has_called","has_errored","done","setTimeout","req","_connect","_i","args","location","reload","apply","connected","_isLocal","_request","then","response","_this","showError","href","url","method","o","JSON","stringify","fetch","_path","res","json","indexOf","Date","getTime","protocol","hostname","innerHTML","_observe","items","Sources","ul","current","item","path_org","tag","removed","$image","mounted","change","querySelector","index","$li","$item","keycode","keyCode","keyname","key","toLowerCase","preventDefault","stopPropagation","keypress","click","moveToDown","moveToUp","approve","li","find","el_","nodeType","Node","ELEMENT_NODE","nodeName","findIndex","isConnected","current_1","onupdate","connect","conn","action","backup","current_2","scroll","scrollTop","height0","rect","getBoundingClientRect","top_","scrollTo","onchange","_get","preview","alert","s","free","replace","blur","ignore_"],"mappings":"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"}