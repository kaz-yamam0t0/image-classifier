!function(){"use strict";var t=function(t,e){(this||window).addEventListener(t,e)},e=null,i=function(t,e){e&&("string"==typeof e&&(e={text:e}),e&&Object.keys(e).forEach((function(i){var s=e[i];null!=s&&("style"==i&&"object"==typeof s?Object.keys(s).forEach((function(e){t.style[e]=s[e]})):"class"==i?Array.isArray(s)?s.forEach((function(e){return t.classList.add(e)})):"object"==typeof s?Object.keys(s).forEach((function(e){1==s[e]?t.classList.add(e):t.classList.remove(e)})):s.split(/\s+/).forEach((function(e){(e=e.trim())&&t.classList.add(e)})):"text"===i?t.textContent=s:t[i]=s)})))},s=function(t,e){i(t,{style:e})},o=function(t,e,s,o){void 0===s&&(s=null),void 0===o&&(o=null);var n=document.createElement(t);return e&&i(n,e),s&&s.appendChild(n),o&&o(n),n},n=function(t,e){void 0===e&&(e=null);var i=(e||document).getElementsByClassName(t);return i.length>0?i[0]:null},h=function(){function i(t){this.mode=0,this.startX=0,this.startY=0,this.pageX=0,this.pageY=0,this._imageStartX=0,this._imageStartY=0,this.imageX=0,this.imageY=0,this.frameX=0,this.frameY=0,this.frameWidth=0,this.frameHeight=0,this.zoom=1,this.image=null,this.el=null,this.bg=null,this.frame=null,this.frameImage=null,this.__mousedown=null,this.__mousemove=null,this.__mouseup=null,this.imageUrl=t.path,this.reset()}return i.prototype.reset=function(){this.mode=0,this.startX=this.startY=0,this.pageX=this.pageY=0,this.imageX=this.imageY=0,this._imageStartX=this._imageStartY=0,this.zoom=1,this.image=null,this.el=null},i.prototype.free=function(){this.frameImage&&this.frameImage.remove(),this.frame&&this.frame.remove(),this.bg&&this.bg.remove(),this.__mousedown&&this.el.removeEventListener("mousedown",this.__mousedown),this.__mousemove&&this.el.removeEventListener("mousemove",this.__mousemove),this.__mouseup&&this.el.removeEventListener("mouseup",this.__mouseup),this.__mousedown=null,this.__mousemove=null,this.__mouseup=null,this.el=null,this.image=null,this.bg=null},i.prototype.mount=function(){if(!(this.el=n("preview")))throw"preview not found.";if(this.image=new Image,this.image.src=this.imageUrl,this.image.complete)this.onload();else{var t=this;this.image.onload=function(){t.onload()},this.image.onerror=function(t){}}},i.prototype.onload=function(){this.bg=o("img",{src:this.imageUrl,class:"bg"},this.el),this.frame=o("div",{class:"frame"},this.el),this.frameImage=o("img",{src:this.imageUrl},this.frame);var t=this.el.clientWidth,e=this.el.clientHeight,i=this.image.width,s=this.image.height,n=1;i>t&&(i*=n=Math.min(n,t/i),s*=n),s>e&&(i*=n=Math.min(n,e/s),s*=n),this.zoom=n,this.imageX=(t-this.image.width*n)/2,this.imageY=(e-this.image.height*n)/2,this.frameWidth=this.image.width,this.frameHeight=this.image.height,this.frameX=this.imageX,this.frameY=this.imageY,this.update(),this.initEvents()},i.prototype.update=function(){if(this.bg&&s(this.bg,{left:"".concat(this.imageX,"px"),top:"".concat(this.imageY,"px"),width:"".concat(this.image.width*this.zoom,"px"),height:"".concat(this.image.height*this.zoom,"px")}),this.frame&&s(this.frame,{left:"".concat(this.frameX,"px"),top:"".concat(this.frameY,"px"),width:"".concat(this.image.width*this.zoom,"px"),height:"".concat(this.image.height*this.zoom,"px")}),this.bg&&this.frame&&this.frameImage){var t=this.imageX-this.frameX,e=this.imageY-this.frameY;s(this.frameImage,{left:"".concat(t,"px"),top:"".concat(e,"px"),width:"".concat(this.image.width*this.zoom,"px"),height:"".concat(this.image.height*this.zoom,"px")})}},i.prototype.initEvents=function(){var e=this;this.__mousedown=function(t){return e.mousedown(t),!1},this.__mousemove=function(t){return e.mousemove(t),!1},this.__mouseup=function(t){return e.mouseup(t),!1},t.call(this.el,"mousedown",this.__mousedown),t.call(this.el,"mousemove",this.__mousemove),t.call(this.el,"mouseup",this.__mouseup)},i.prototype.mousedown=function(t){var e;this.mode=1,this.pageX=this.startX=t.pageX,this.pageY=this.startY=t.pageY,e=[this.imageX,this.imageY],this._imageStartX=e[0],this._imageStartY=e[1],this.update(),this._debug()},i.prototype.mousemove=function(t){var e;1==this.mode&&(e=[t.pageX,t.pageY],this.pageX=e[0],this.pageY=e[1],this.imageX=this._imageStartX+(this.pageX-this.startX),this.imageY=this._imageStartY+(this.pageY-this.startY),this.update(),this._debug())},i.prototype.mouseup=function(t){this.mode=0,this.pageX=this.startX=0,this.pageY=this.startY=0,this._imageStartX=this._imageStartY=0},i.prototype._debug=function(){!function(t){null==e&&(e=o("div",{class:"debugger"},document.body)),e.innerHTML=t}("\n\t\t\tmode: ".concat(this.mode,"<br />\n\t\t\tstart: (").concat(this.startX,", ").concat(this.startY,")<br />\n\t\t\tpageX/Y: (").concat(this.pageX,", ").concat(this.pageY,")<br />\n\t\t\timage: (").concat(this.imageX,", ").concat(this.imageX,")<br />\n\t\t\tzoom: ").concat(this.zoom,"\n\t\t"))},i}(),a="http://localhost:8080",r=function(){function e(t){this.el=null,this.ul=null,this.current=0,this.mounted=!1,this.onchange=null,this.onupdate=null,this.items=[],this.add(t)}return e.prototype.add=function(t){var e=this;t.forEach((function(t){"string"==typeof t&&((t={name:t,path:"".concat("data","/").concat(t),tag:null,done:!1,removed:!1}).$image=new Image,t.$image.src=t.path),e.items.push(t)})),this.mounted&&this.update()},e.prototype.mount=function(){if(!(this.el=n("sources")))throw"`.sources` not found.";(this.ul=this.el.querySelector("ul"))||(this.ul=o("ul",null,this.el)),this.mounted=!0,this.update(),this.initEvents(),this.change()},e.prototype.update=function(){var t=this;this.items.forEach((function(e,i){var s=e.$li=e.$li||o("li",null,t.ul),h=n("item",s)||o("div",{class:"item"},s);n("image",h)||o("div",{class:"image"},h,(function(t){t.appendChild(e.$image)})),(n("name",h)||o("div",{class:"name"},h)).textContent=e.name,t.current==i?h.classList.add("-active"):h.classList.remove("-active"),e.done?(s.classList.add("-ok"),s.classList.remove("-removed")):e.removed?(s.classList.remove("-ok"),s.classList.add("-removed")):(s.classList.remove("-ok"),s.classList.remove("-removed"))}))},e.prototype.initEvents=function(){var e=this;t.call(document.body,"keydown",(function(t){var i=t.keyCode,s="".concat(t.key).toLowerCase();return 40!=i&&"arrowdown"!=s&&38!=i&&"arrowup"!=s||(t.preventDefault(),t.stopPropagation()),e.keypress(t),!1})),t.call(this.ul,"click",(function(t){e.click(t)}))},e.prototype.keypress=function(t){var e=t.keyCode,i="".concat(t.key).toLowerCase();40!=e&&"arrowdown"!=i||this.moveToDown(),38!=e&&"arrowup"!=i||this.moveToUp(),8!=e&&"backspace"!=i||this.remove(),13!=e&&"enter"!=i||this.approve()},e.prototype.click=function(t){if(t.path){var e=t.path.find((function(t){return t.nodeType==Node.ELEMENT_NODE&&"li"=="".concat(t.nodeName).toLowerCase()})),i=this.items.findIndex((function(t){return t.$li==e}));i>=0&&(this.current=i),this.update(),this.change()}},e.prototype.remove=function(){void 0!==this.items[this.current]&&(this.items[this.current].done=!1,this.items[this.current].removed=!0,this.onupdate&&this.onupdate(this.items[this.current])),this.update(),this.moveToDown()},e.prototype.approve=function(){void 0!==this.items[this.current]&&(this.items[this.current].done=!0,this.items[this.current].removed=!1,this.onupdate&&this.onupdate(this.items[this.current])),this.update(),this.moveToDown()},e.prototype.moveToUp=function(){this.items.length<=0?this.current=0:this.current>0&&this.current--,this.update(),this.change(),this.scroll()},e.prototype.moveToDown=function(){this.items.length<=0?this.current=0:this.current<this.items.length-1&&this.current++,this.update(),this.change(),this.scroll()},e.prototype.scroll=function(){if(void 0!==this.items[this.current]){var t=this.el.scrollTop,e=this.el.clientHeight;this.el.querySelector("ul").clientHeight;var i=this.items[this.current].$li.getBoundingClientRect(),s=t+i.top-(e-i.height)/2;this.el.scrollTo(0,s)}},e.prototype.change=function(){void 0!==this.items[this.current]&&this.onchange&&this.onchange.call(this,this.items[this.current])},e}(),c=null,u=function(){function t(){this.connected=!1,this.mount()}return t.prototype.mount=function(){this.el=o("div",{class:"global-error"},document.body),this.el.style.display="none"},t.prototype._observe=function(t){var e=this,i=function(){setTimeout((function(){s()}),2e6)},s=function(){e._connect((function(t,s){t?(e.connected=!0,i()):(e.connected=!1,i())}))};s()},t.prototype._connect=function(t){if(!this._isLocal()){var e=this;return this._request().then((function(e){t&&t(!0,e.json())})).catch((function(i){console.error(i),t&&t(!1,i),e.showError()}))}location.href="".concat(a,"/")},t.prototype._request=function(t,e){return void 0===t&&(t="/status"),void 0===e&&(e="GET"),fetch(this._path(t),{method:e})},t.prototype._path=function(t){return t.indexOf("://")>=0||0===t.indexOf("//")?t:("/"!=t[0]&&(t="/".concat(t)),a+t)},t.prototype._isLocal=function(){return!location||!location.protocol||"file:"==location.protocol||("http:"!=location.protocol&&"https://"!=location.protocol||(!location.hostname||""=="".concat(location.hostname).trim()))},t.prototype.showError=function(){this.el&&(this.el.innerHTML="Connection failed. Please make sure your python server is runnning. You can start the server with <code>$ python app.py</code>.",this.el.style.display="block")},t.prototype.hideError=function(){this.el&&(this.el.style.display="none")},t.connect=function(e){return c||((c=new t).mount(),c._observe(e)),c},t}();t("wheel",(function(){return!1})),u.connect((function(t,e){0!=t&&console.log(e)}));var m=null,l=new r(["seed0000.jpg","seed0001.jpg","seed0002.jpg","seed0003.jpg","seed0004.jpg","seed0005.jpg","seed0006.jpg","seed0007.jpg","seed0009.jpg","seed0012.jpg","seed0014.jpg"]);l.add(["seed0000.jpg","seed0001.jpg","seed0002.jpg","seed0003.jpg","seed0004.jpg","seed0005.jpg","seed0006.jpg","seed0007.jpg","seed0009.jpg","seed0012.jpg","seed0014.jpg"]),l.onchange=function(t){m&&(m.free(),m=null),(m=new h(t)).mount()},l.onupdate=function(t){},l.mount()}();
//# sourceMappingURL=main.js.map
