!function(){"use strict";var t=function(t,e){(this||window).addEventListener(t,e)},e=null,i=function(t,e){e&&("string"==typeof e&&(e={text:e}),e&&Object.keys(e).forEach((function(i){var o=e[i];null!=o&&("style"==i&&"object"==typeof o?Object.keys(o).forEach((function(e){t.style[e]=o[e]})):"class"==i?Array.isArray(o)?o.forEach((function(e){return t.classList.add(e)})):"object"==typeof o?Object.keys(o).forEach((function(e){1==o[e]?t.classList.add(e):t.classList.remove(e)})):o.split(/\s+/).forEach((function(e){(e=e.trim())&&t.classList.add(e)})):"text"===i?t.textContent=o:t[i]=o)})))},o=function(t,e){i(t,{style:e})},n=function(t,e,o,n){void 0===o&&(o=null),void 0===n&&(n=null);var s=document.createElement(t);return e&&i(s,e),o&&o.appendChild(s),n&&n(s),s},s=function(t,e){void 0===e&&(e=null);var i=(e||document).getElementsByClassName(t);return i.length>0?i[0]:null},h=function(){function i(t){this.mode=0,this.startX=0,this.startY=0,this.pageX=0,this.pageY=0,this._imageStartX=0,this._imageStartY=0,this.imageX=0,this.imageY=0,this.frameX=0,this.frameY=0,this.frameWidth=0,this.frameHeight=0,this.zoom=1,this.image=null,this.el=null,this.bg=null,this.frame=null,this.frameImage=null,this.__mousedown=null,this.__mousemove=null,this.__mouseup=null,this.imageUrl=t.path,this.reset()}return i.prototype.reset=function(){this.mode=0,this.startX=this.startY=0,this.pageX=this.pageY=0,this.imageX=this.imageY=0,this._imageStartX=this._imageStartY=0,this.zoom=1,this.image=null,this.el=null},i.prototype.free=function(){this.frameImage&&this.frameImage.remove(),this.frame&&this.frame.remove(),this.bg&&this.bg.remove(),this.__mousedown&&this.el.removeEventListener("mousedown",this.__mousedown),this.__mousemove&&this.el.removeEventListener("mousemove",this.__mousemove),this.__mouseup&&this.el.removeEventListener("mouseup",this.__mouseup),this.__mousedown=null,this.__mousemove=null,this.__mouseup=null,this.el=null,this.image=null,this.bg=null},i.prototype.mount=function(){if(!(this.el=s("preview")))throw"preview not found.";if(this.image=new Image,this.image.src=this.imageUrl,this.image.complete)this.onload();else{var t=this;this.image.onload=function(){t.onload()},this.image.onerror=function(t){}}},i.prototype.onload=function(){this.bg=n("img",{src:this.imageUrl,class:"bg"},this.el),this.frame=n("div",{class:"frame"},this.el),this.frameImage=n("img",{src:this.imageUrl},this.frame);var t=this.el.clientWidth,e=this.el.clientHeight,i=this.image.width,o=this.image.height,s=1;i>t&&(i*=s=Math.min(s,t/i),o*=s),o>e&&(i*=s=Math.min(s,e/o),o*=s),this.zoom=s,this.imageX=(t-this.image.width*s)/2,this.imageY=(e-this.image.height*s)/2,this.frameWidth=this.image.width,this.frameHeight=this.image.height,this.frameX=this.imageX,this.frameY=this.imageY,this.update(),this.initEvents()},i.prototype.update=function(){if(this.bg&&o(this.bg,{left:"".concat(this.imageX,"px"),top:"".concat(this.imageY,"px"),width:"".concat(this.image.width*this.zoom,"px"),height:"".concat(this.image.height*this.zoom,"px")}),this.frame&&o(this.frame,{left:"".concat(this.frameX,"px"),top:"".concat(this.frameY,"px"),width:"".concat(this.image.width*this.zoom,"px"),height:"".concat(this.image.height*this.zoom,"px")}),this.bg&&this.frame&&this.frameImage){var t=this.imageX-this.frameX,e=this.imageY-this.frameY;o(this.frameImage,{left:"".concat(t,"px"),top:"".concat(e,"px"),width:"".concat(this.image.width*this.zoom,"px"),height:"".concat(this.image.height*this.zoom,"px")})}},i.prototype.initEvents=function(){var e=this;this.__mousedown=function(t){return e.mousedown(t),!1},this.__mousemove=function(t){return e.mousemove(t),!1},this.__mouseup=function(t){return e.mouseup(t),!1},t.call(this.el,"mousedown",this.__mousedown),t.call(this.el,"mousemove",this.__mousemove),t.call(this.el,"mouseup",this.__mouseup)},i.prototype.mousedown=function(t){var e;this.mode=1,this.pageX=this.startX=t.pageX,this.pageY=this.startY=t.pageY,e=[this.imageX,this.imageY],this._imageStartX=e[0],this._imageStartY=e[1],this.update(),this._debug()},i.prototype.mousemove=function(t){var e;1==this.mode&&(e=[t.pageX,t.pageY],this.pageX=e[0],this.pageY=e[1],this.imageX=this._imageStartX+(this.pageX-this.startX),this.imageY=this._imageStartY+(this.pageY-this.startY),this.update(),this._debug())},i.prototype.mouseup=function(t){this.mode=0,this.pageX=this.startX=0,this.pageY=this.startY=0,this._imageStartX=this._imageStartY=0},i.prototype._debug=function(){var t;t="\n\t\t\tmode: ".concat(this.mode,"<br />\n\t\t\tstart: (").concat(this.startX,", ").concat(this.startY,")<br />\n\t\t\tpageX/Y: (").concat(this.pageX,", ").concat(this.pageY,")<br />\n\t\t\timage: (").concat(this.imageX,", ").concat(this.imageX,")<br />\n\t\t\tzoom: ").concat(this.zoom,"\n\t\t"),null==e&&(e=n("div",{class:"debugger"},document.body)),e.innerHTML=t},i}(),a="data",r="http://localhost:8080",c=null,u=function(){function t(){this.connected=!1,this.mount()}return t.prototype.mount=function(){this.el=n("div",{class:"global-error"},document.body),this.el.style.display="none"},t.prototype._observe=function(t,e){var i=!1,o=!1,n=this,s=function(){setTimeout((function(){h()}),2e3)},h=function(){n._connect((function(){for(var e=[],h=0;h<arguments.length;h++)e[h]=arguments[h];o?location.reload():(0==i&&(t.apply(null,e),i=!0),n.connected=!0,s())}),(function(t){o=!0,e&&e(t),s()}))};h()},t.prototype._connect=function(t,e){var i=this;if(void 0===t&&(t=null),void 0===e&&(e=null),!this._isLocal()){var o=this;return this._request().then((function(e){t&&t.call(null,i)})).catch((function(t){e&&e.call(null,t),o.connected=!1,o.showError()}))}location.href="".concat(r,"/")},t.prototype._request=function(t,e,i){void 0===t&&(t="/status"),void 0===e&&(e="GET"),void 0===i&&(i=null);var o={method:e};return"POST"==e&&(o.headers={"Content-Type":"application/json"},o.body=JSON.stringify(i)),console.log(t,o),fetch(this._path(t),o)},t.prototype._path=function(t){return t.indexOf("://")>=0||0===t.indexOf("//")?t:("/"!=t[0]&&(t="/".concat(t)),r+t)},t.prototype._isLocal=function(){return!location||!location.protocol||"file:"==location.protocol||("http:"!=location.protocol&&"https://"!=location.protocol||(!location.hostname||""=="".concat(location.hostname).trim()))},t.prototype.showError=function(){this.el&&(this.el.innerHTML="Connection failed. Make sure app.py server is runnning. <code>$ python app.py</code>.",this.el.style.display="block")},t.prototype.hideError=function(){this.el&&(this.el.style.display="none")},t.connect=function(e,i){return void 0===i&&(i=null),c?c.connected?e&&e.call(null,c):c._observe(e,i):(c=new t)._observe(e,i),c},t.isConnected=function(){return!!c&&c.connected},t}(),l=function(){function e(t){this.el=null,this.ul=null,this.current=0,this.mounted=!1,this.onchange=null,this.onupdate=null,this.items=[],this.add(t)}return e.prototype.add=function(t){var e=this;t.forEach((function(t){"string"==typeof t&&((t={name:t,path_org:"".concat(a,"/").concat(t),path:"".concat(a,"/").concat(t),tag:null,done:!1,removed:!1}).$image=new Image,t.$image.src=t.path),e.items.push(t)})),this.mounted&&this.update()},e.prototype.mount=function(){if(!(this.el=s("sources")))throw"`.sources` not found.";(this.ul=this.el.querySelector("ul"))||(this.ul=n("ul",null,this.el)),this.mounted=!0,this.update(),this.initEvents(),this.change()},e.prototype.update=function(){var t=this;this.items.forEach((function(e,i){var o=e.$li=e.$li||n("li",null,t.ul),h=s("item",o)||n("div",{class:"item"},o);s("image",h)||n("div",{class:"image"},h,(function(t){t.appendChild(e.$image)})),(s("name",h)||n("div",{class:"name"},h)).textContent=e.name,t.current==i?h.classList.add("-active"):h.classList.remove("-active"),e.done?(o.classList.add("-ok"),o.classList.remove("-removed")):e.removed?(o.classList.remove("-ok"),o.classList.add("-removed")):(o.classList.remove("-ok"),o.classList.remove("-removed"))}))},e.prototype.initEvents=function(){var e=this;t.call(document.body,"keydown",(function(t){var i=t.keyCode,o="".concat(t.key).toLowerCase();return 40!=i&&"arrowdown"!=o&&38!=i&&"arrowup"!=o||(t.preventDefault(),t.stopPropagation()),e.keypress(t),!1})),t.call(this.ul,"click",(function(t){e.click(t)}))},e.prototype.keypress=function(t){var e=t.keyCode,i="".concat(t.key).toLowerCase();40!=e&&"arrowdown"!=i||this.moveToDown(),38!=e&&"arrowup"!=i||this.moveToUp(),8!=e&&"backspace"!=i||this.remove(),13!=e&&"enter"!=i||this.approve()},e.prototype.click=function(t){if(t.path){var e=t.path.find((function(t){return t.nodeType==Node.ELEMENT_NODE&&"li"=="".concat(t.nodeName).toLowerCase()})),i=this.items.findIndex((function(t){return t.$li==e}));i>=0&&(this.current=i),this.update(),this.change()}},e.prototype.remove=function(){if(u.isConnected()){if(void 0!==this.items[this.current]){var t=this.items[this.current];if(t.removed)return this.update(),void this.moveToDown();t.done=!1,t.removed=!0,this.onupdate&&this.onupdate(t),u.connect((function(e){e._request("/update","POST",{name:t.name,src:t.path,action:"remove"}).then((function(e){e.json().then((function(e){e.dst&&(t.path=e.dst)}))}))}))}this.update(),this.moveToDown()}else this.moveToDown()},e.prototype.approve=function(){if(u.isConnected()){if(void 0!==this.items[this.current]){var t=this.items[this.current];if(t.done)return this.update(),void this.moveToDown();t.done=!0,t.removed=!1,this.onupdate&&this.onupdate(t),u.connect((function(e){e._request("/update","POST",{name:t.name,src:t.path,action:"ok"}).then((function(e){e.json().then((function(e){e.dst&&(t.path=e.dst)}))}))}))}this.update(),this.moveToDown()}else this.moveToDown()},e.prototype.moveToUp=function(){this.items.length<=0?this.current=0:this.current>0&&this.current--,this.update(),this.change(),this.scroll()},e.prototype.moveToDown=function(){this.items.length<=0?this.current=0:this.current<this.items.length-1&&this.current++,this.update(),this.change(),this.scroll()},e.prototype.scroll=function(){if(void 0!==this.items[this.current]){var t=this.el.scrollTop,e=this.el.clientHeight;this.el.querySelector("ul").clientHeight;var i=this.items[this.current].$li.getBoundingClientRect(),o=t+i.top-(e-i.height)/2;this.el.scrollTo(0,o)}},e.prototype.change=function(){void 0!==this.items[this.current]&&this.onchange&&this.onchange.call(this,this.items[this.current])},e}();t("wheel",(function(){return!1})),u.connect((function(t){t&&t._request("/list").then((function(t){t.json().then((function(t){var e=null,i=new l(t.sources);i.onchange=function(t){e&&(e.free(),e=null),(e=new h(t)).mount()},i.onupdate=function(t){},i.mount()}))}))}))}();
//# sourceMappingURL=main.js.map
