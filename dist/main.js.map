{"version":3,"file":"main.js","sources":["../src/js/util.ts","../src/js/preview.ts","../src/js/config.ts","../src/js/connection.ts","../src/js/sources.ts","../src/js/main.ts"],"sourcesContent":["\nconst listen = function(name:string, callback) {\n\t(this || window).addEventListener(name, callback);\n};\n\n// debugger\nlet _debug = null;\nconst debug = (s:string)=>{\n\tif (_debug == null) {\n\t\t_debug = createElement(\"div\", {\"class\":\"debugger\"}, document.body);\n\t}\n\t_debug.innerHTML = s;\n};\n\n\n\nconst setAttrs = (el:any, attrs:any)=>{\n\tif (!attrs) {\n\t\treturn;\n\t}\n\tif (typeof attrs === \"string\") {\n\t\tattrs = { \"text\" : attrs };\n\t}\n\tif (attrs) {\n\t\tObject.keys(attrs).forEach((k)=>{\n\t\t\tconst v = attrs[k];\n\t\t\tif (typeof v === \"undefined\" || v === null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// style\n\t\t\tif (k == \"style\" && (typeof v === \"object\")) {\n\t\t\t\tObject.keys(v).forEach(k_=>{\n\t\t\t\t\tel.style[k_] = v[k_];\n\t\t\t\t});\n\t\t\t} \n\t\t\t// class\n\t\t\telse if (k == \"class\") {\n\t\t\t\tif (Array.isArray(v)) {\n\t\t\t\t\tv.forEach(v_=>el.classList.add(v_));\n\t\t\t\t} else if (typeof v === \"object\") {\n\t\t\t\t\tObject.keys(v).forEach(k_=>{\n\t\t\t\t\t\tif (v[k_] == true) {\n\t\t\t\t\t\t\tel.classList.add(k_);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tel.classList.remove(k_);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tv.split(/\\s+/).forEach(v_=>{\n\t\t\t\t\t\tif (v_ = v_.trim()) el.classList.add(v_);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} \n\t\t\t// text\n\t\t\telse if (k === \"text\") {\n\t\t\t\tel.textContent = v;\n\t\t\t}\n\t\t\t// default\n\t\t\telse {\n\t\t\t\tel[k] = v\n\t\t\t}\n\t\t});\t\n\t}\n};\nconst setStyle = (el:any, styles:Object)=>{\n\tsetAttrs(el, { \"style\": styles });\n};\nconst createElement = (tagName:string, attrs:any, parentNode:any=null, callback:any=null)=>{\n\tconst el = document.createElement(tagName);\n\tif (attrs) setAttrs(el, attrs);\n\n\tif (parentNode) {\n\t\tparentNode.appendChild(el)\n\t}\n\tif (callback) {\n\t\tcallback(el);\n\t}\n\treturn el;\n};\n\nconst find = (q:string, el:any=null)=>{\n\treturn (el || document).querySelector(q);\n};\nconst findByClass = (q:string, el:any=null)=>{\n\tconst elements = (el || document).getElementsByClassName(q);\n\tif (elements.length > 0) return elements[0];\n\treturn null;\n};\n\n\nexport {\n\tlisten,\n\tdebug,\n\tcreateElement, \n\tsetAttrs,\n\tsetStyle, \n\n\tfind,\n\tfindByClass,\n}","\n\nimport { listen, debug, setStyle, createElement, findByClass } from './util';\n\nclass Preview {\n\tmode = 0; // 1=mousedown\n\n\t// event position\n\tstartX = 0;\n\tstartY = 0;\n\tpageX = 0;\n\tpageY = 0;\n\t\n\t// image position\n\t_imageStartX = 0;\n\t_imageStartY = 0;\n\timageX = 0;\n\timageY = 0;\n\n\t// frame position\n\tframeX = 0;\n\tframeY = 0;\n\tframeWidth = 0;\n\tframeHeight = 0;\n\n\t// zoom\n\tzoom = 1;\n\n\t// image data\n\timageUrl: string;\n\timage = null; // Image\n\n\t// elements\n\tel = null; // div.preview\n\tbg = null; // <img>\n\tframe = null; // <div>\n\tframeImage = null; // <img>\n\n\t// event callbacks\n\t__mousedown = null;\n\t__mousemove = null;\n\t__mouseup = null;\n\n\tconstructor(image_data) {\n\t\tthis.imageUrl = image_data.path;\n\t\tthis.reset();\n\t}\n\treset() {\n\t\tthis.mode = 0;\n\t\tthis.startX = this.startY = 0;\n\t\tthis.pageX = this.pageY = 0;\n\t\tthis.imageX = this.imageY = 0;\n\t\tthis._imageStartX = this._imageStartY = 0;\n\n\t\tthis.zoom = 1;\n\n\t\tthis.image = null;\n\t\tthis.el = null;\n\t}\n\tfree() {\n\t\tif (this.frameImage) this.frameImage.remove();\n\t\tif (this.frame) this.frame.remove();\n\t\tif (this.bg) this.bg.remove();\n\n\t\tif (this.__mousedown) this.el.removeEventListener(\"mousedown\", this.__mousedown);\n\t\tif (this.__mousemove) this.el.removeEventListener(\"mousemove\", this.__mousemove);\n\t\tif (this.__mouseup) this.el.removeEventListener(\"mouseup\", this.__mouseup);\n\n\t\tthis.__mousedown = null;\n\t\tthis.__mousemove = null;\n\t\tthis.__mouseup = null;\n\n\t\tthis.el = null;\n\t\tthis.image = null;\n\t\tthis.bg = null;\n\t}\n\n\tmount() {\n\t\tif (!(this.el = findByClass(\"preview\"))) {\n\t\t\tthrow 'preview not found.';\t\t\t\n\t\t}\n\t\tthis.image = new Image();\n\t\tthis.image.src = this.imageUrl;\n\n\t\tif (this.image.complete) {\n\t\t\tthis.onload();\n\t\t} else {\n\t\t\tconst self = this;\n\t\t\tthis.image.onload = ()=>{\n\t\t\t\tself.onload();\n\t\t\t};\n\t\t\tthis.image.onerror = (err)=>{\n\n\t\t\t};\n\t\t}\n\t}\n\tonload() {\n\t\tthis.bg = createElement(\"img\", {\n\t\t\t\"src\" : this.imageUrl,\n\t\t\t\"class\" : \"bg\",\n\t\t}, this.el);\n\n\t\tthis.frame = createElement(\"div\", {\"class\": \"frame\"}, this.el);\n\n\t\tthis.frameImage = createElement(\"img\", {\n\t\t\t\"src\" : this.imageUrl,\n\t\t}, this.frame);\n\n\t\t// calculate ratio\n\t\tlet w0 = this.el.clientWidth, \n\t\t\th0 = this.el.clientHeight, \n\t\t\tw = this.image.width, \n\t\t\th = this.image.height;\n\t\t\n\t\tlet r = 1;\n\t\tif (w > w0) {\n\t\t\tr = Math.min(r, w0 / w);\n\t\t\tw *= r; h *= r;\n\t\t}\n\t\tif (h > h0) {\n\t\t\tr = Math.min(r, h0 / h);\n\t\t\tw *= r; h *= r;\n\t\t}\n\n\t\t// initialize image size and position\n\t\tthis.zoom = r;\n\t\tthis.imageX = (w0 - this.image.width * r) / 2;\n\t\tthis.imageY = (h0 - this.image.height * r) / 2;\n\t\t\n\t\t// calculate frame position\n\t\tthis.frameWidth = this.image.width; // * r;\n\t\tthis.frameHeight = this.image.height; // * r;\n\t\tthis.frameX = this.imageX;\n\t\tthis.frameY = this.imageY;\n\n\t\t// update \n\t\tthis.update();\n\n\t\t// init events\n\t\tthis.initEvents();\n\t}\n\tupdate() {\n\t\tif (this.bg) {\n\t\t\tsetStyle(this.bg, {\n\t\t\t\t\"left\" : `${this.imageX}px`,\n\t\t\t\t\"top\" : `${this.imageY}px`,\n\t\t\t\t\"width\" : `${this.image.width * this.zoom}px`,\n\t\t\t\t\"height\" : `${this.image.height * this.zoom}px`,\n\t\t\t});\n\t\t}\n\t\tif (this.frame) {\n\t\t\tsetStyle(this.frame, {\n\t\t\t\t\"left\" : `${this.frameX}px`,\n\t\t\t\t\"top\" : `${this.frameY}px`,\n\t\t\t\t\"width\" : `${this.image.width * this.zoom}px`,\n\t\t\t\t\"height\" : `${this.image.height * this.zoom}px`,\n\t\t\t});\n\t\t}\n\t\tif (this.bg && this.frame && this.frameImage) {\n\t\t\tconst x = this.imageX - this.frameX;\n\t\t\tconst y = this.imageY - this.frameY;\n\n\t\t\tsetStyle(this.frameImage, {\n\t\t\t\t\"left\" : `${x}px`,\n\t\t\t\t\"top\" : `${y}px`,\n\t\t\t\t\"width\" : `${this.image.width * this.zoom}px`,\n\t\t\t\t\"height\" : `${this.image.height * this.zoom}px`,\n\t\t\t});\n\t\t}\n\t}\n\n\t// event\n\tinitEvents() {\n\t\tconst self = this;\n\t\tthis.__mousedown = (e)=>{\n\t\t\tself.mousedown(e);\n\t\t\treturn false;\n\t\t};\n\t\tthis.__mousemove = (e)=>{\n\t\t\tself.mousemove(e);\n\t\t\treturn false;\n\t\t};\n\t\tthis.__mouseup = (e)=>{\n\t\t\tself.mouseup(e);\n\t\t\treturn false;\n\t\t};\n\n\t\tlisten.call(this.el, \"mousedown\", this.__mousedown);\n\t\tlisten.call(this.el, \"mousemove\", this.__mousemove);\n\t\tlisten.call(this.el, \"mouseup\", this.__mouseup);\t\n\t}\n\tmousedown(e) {\n\t\tthis.mode = 1;\n\t\tthis.pageX = this.startX = e.pageX;\n\t\tthis.pageY = this.startY = e.pageY;\n\t\t[this._imageStartX, this._imageStartY] = [this.imageX, this.imageY];\n\t\tthis.update();\n\t\tthis._debug();\n\t}\n\tmousemove(e) {\n\t\tif (this.mode != 1) return;\n\n\t\t[this.pageX, this.pageY] = [e.pageX, e.pageY];\n\t\tthis.imageX = this._imageStartX + (this.pageX - this.startX);\n\t\tthis.imageY = this._imageStartY + (this.pageY - this.startY);\n\t\tthis.update();\n\t\tthis._debug();\n\t}\n\tmouseup(e) {\n\t\tthis.mode = 0;\n\t\tthis.pageX = this.startX = 0;\n\t\tthis.pageY = this.startY = 0;\n\t\tthis._imageStartX = this._imageStartY = 0;\n\t}\n\n\t_debug() {\n\t\tdebug(`\n\t\t\tmode: ${this.mode}<br />\n\t\t\tstart: (${this.startX}, ${this.startY})<br />\n\t\t\tpageX/Y: (${this.pageX}, ${this.pageY})<br />\n\t\t\timage: (${this.imageX}, ${this.imageX})<br />\n\t\t\tzoom: ${this.zoom}\n\t\t`);\n\t}\n}\nexport default Preview;\n","\nconst DATA_DIR = 'data';\nconst CONNECTION_URL = 'http://localhost:8080';\nconst CONNECTION_INTERVAL_T = 2000;\nexport {\n\tDATA_DIR,\n\tCONNECTION_URL,\n\tCONNECTION_INTERVAL_T,\n};","\nimport { listen, debug, setStyle, createElement, findByClass } from './util';\nimport { DATA_DIR, CONNECTION_URL, CONNECTION_INTERVAL_T } from './config';\n\n\nlet instance = null;\n\nclass Connection {\n\tconnected:boolean = false;\n\tel: any; \n\n\tconstructor() {\n\t\tthis.mount();\n\t\t// this.showError();\n\t}\n\n\tmount() {\n\t\tthis.el = createElement(\"div\", {\"class\": \"global-error\"}, document.body);\n\t\tthis.el.style.display = \"none\";\n\t}\n\t_observe(callback, error) {\n\t\tlet has_called = false;\n\t\tlet has_errored = false;\n\n\t\tconst self = this;\n\t\tconst done = ()=>{\n\t\t\tsetTimeout(()=>{\n\t\t\t\treq();\n\t\t\t}, CONNECTION_INTERVAL_T);\n\t\t};\n\t\tconst req = ()=>{\n\t\t\tself._connect((...args)=>{\n\t\t\t\tif (has_errored) { \n\t\t\t\t\t// reload when reconnected\n\t\t\t\t\tlocation.reload();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (has_called == false) {\n\t\t\t\t\tcallback.apply(null, args);\n\t\t\t\t\thas_called = true;\n\t\t\t\t}\n\t\t\t\tself.connected = true;\n\t\t\t\tdone();\n\t\t\t}, (err)=> {\n\t\t\t\thas_errored = true;\n\n\t\t\t\tif (error) error(err);\n\t\t\t\tdone();\n\t\t\t});\n\t\t};\n\t\treq();\n\t}\n\t_connect(callback=null, error=null) {\n\t\tif (this._isLocal()) {\n\t\t\tlocation.href = `${CONNECTION_URL}/`;\n\t\t\treturn;\n\t\t}\n\n\t\t//if (this.connected) {\n\t\t//\tif (callback()) callback(true);\n\t\t//\treturn;\n\t\t//}\n\t\tconst self = this;\n\n\t\treturn this._request()\n\t\t\t.then(response=>{\n\t\t\t\tif (callback) callback.call(null, this);\n\t\t\t})\n\t\t\t.catch((err)=>{\n\t\t\t\t// if (callback) callback.call(null, null, err);\n\t\t\t\tif (error) error.call(null, err);\n\n\t\t\t\tself.connected = false;\n\t\t\t\tself.showError();\n\t\t\t});\n\t}\n\t_request(url:string=\"/status\", method:string=\"GET\", data:any=null) {\n\t\tlet o = { method }\n\t\tif (method == \"POST\") {\n\t\t\to[\"headers\"] = {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// 'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t}\n\t\t\to[\"body\"] = JSON.stringify(data);\n\t\t} \n\t\tconsole.log(url, o);\n\t\tconst p = fetch(this._path(url), o);\n\t\treturn p;\n\t}\n\t_path(url:string) {\n\t\tif (url.indexOf(\"://\") >= 0 || url.indexOf(\"//\") === 0) {\n\t\t\treturn url;\n\t\t}\n\t\tif (url[0] != \"/\") url = `/${url}`;\n\n\t\treturn CONNECTION_URL + url;\n\t}\t\n\t_isLocal() {\n\t\tif (! location || !location.protocol || location.protocol == \"file:\") {\n\t\t\treturn true;\n\t\t}\n\t\tif (location.protocol != \"http:\" && location.protocol != \"https://\") {\n\t\t\treturn true;\n\t\t}\n\t\tif (!location.hostname || `${location.hostname}`.trim() == \"\") {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tshowError() {\n\t\tif (!this.el) return;\n\n\t\tthis.el.innerHTML = 'Connection failed. Make sure app.py server is runnning. <code>$ python app.py</code>.';\n\t\tthis.el.style.display = \"block\";\t\t\n\t}\n\thideError() {\n\t\tif (!this.el) return;\n\t\t\n\t\tthis.el.style.display = \"none\";\n\t}\n\n\tstatic connect(callback, error=null) {\n\t\tif (! instance) {\n\t\t\tinstance = new Connection();\n\t\t\tinstance._observe(callback, error);\n\t\t} else {\n\t\t\tif (instance.connected) {\n\t\t\t\tif (callback) callback.call(null, instance);\n\t\t\t} else {\n\t\t\t\tinstance._observe(callback, error);\n\t\t\t}\n\t\t}\n\t\treturn instance;\n\t}\n\tstatic isConnected() {\n\t\tif (! instance) {\n\t\t\treturn false;\n\t\t}\n\t\treturn instance.connected;\n\t}\n}\n\nexport default Connection;\n","import { listen, debug, setStyle, createElement, findByClass } from './util';\nimport { DATA_DIR } from './config';\n\nimport Connection from './connection';\n\nclass Sources {\n\titems: {\n\t\tname: string, \n\t\tpath_org: string,\n\t\tpath: string, \n\t\ttag: string,\n\t\tdone: boolean,\n\t\tremoved: boolean,\n\n\t\t$li: any, // <li>\n\t\t$image: any, // <img>\n\t}[];\n\n\tel = null; // div.sources\n\tul = null; // <ul>\n\n\tcurrent:number = 0; // item of this.items \n\tmounted:boolean = false;\n\tonchange = null;\n\tonupdate = null;\n\n\tconstructor(items: any[]) {\n\t\tconst self = this;\n\n\t\tthis.items = [];\n\t\tthis.add(items);\n\t}\n\tadd(items: any[]) {\n\t\tconst self = this;\n\n\t\titems.forEach((item)=>{\n\t\t\tif (typeof item === \"string\") {\n\t\t\t\titem = { \n\t\t\t\t\tname: item,  \n\t\t\t\t\tpath_org: `${DATA_DIR}/${item}`,\n\t\t\t\t\tpath: `${DATA_DIR}/${item}`,\n\t\t\t\t\ttag: null,\n\t\t\t\t\tdone: false,\n\t\t\t\t\tremoved: false,\n\t\t\t\t};\n\t\t\t\titem.$image = new Image();\n\t\t\t\titem.$image.src = item.path;\n\t\t\t}\n\t\t\tself.items.push(item);\n\t\t});\n\n\t\tif (this.mounted) {\n\t\t\tthis.update();\n\t\t}\n\t}\n\n\tmount() {\n\t\tif (!(this.el = findByClass(\"sources\"))) {\n\t\t\tthrow '`.sources` not found.';\t\t\t\n\t\t}\n\t\tif (!(this.ul = this.el.querySelector(\"ul\"))) {\n\t\t\t// throw '`.sources > ul` not found.';\t\n\t\t\tthis.ul = createElement(\"ul\", null, this.el);\n\t\t}\n\n\t\tthis.mounted = true;\n\n\t\tthis.update();\n\t\tthis.initEvents();\n\n\t\tthis.change();\n\t}\n\tupdate() {\n\t\tconst self = this;\n\t\tthis.items.forEach((item, index)=>{\n\t\t\t// $li\n\t\t\tlet $li = item.$li = item.$li || createElement(\"li\",null, self.ul);\n\t\t\t//$li.setAttribute(\"title\", item.path);\n\n\t\t\t// $item\n\t\t\tlet $item = findByClass(\"item\", $li) || createElement(\"div\", { \"class\":\"item\" }, $li);\n\t\t\tlet $image = findByClass(\"image\", $item) || createElement(\"div\", {\"class\":\"image\"}, $item, (el)=>{\n\t\t\t\tel.appendChild(item.$image);\n\t\t\t});\n\t\t\tlet $name = findByClass(\"name\", $item) || createElement(\"div\", {\"class\":\"name\"}, $item);\n\t\t\t\n\t\t\t$name.textContent = item.name;\n\n\t\t\tif (self.current == index) {\n\t\t\t\t$item.classList.add(\"-active\");\n\t\t\t} else {\n\t\t\t\t$item.classList.remove(\"-active\");\n\t\t\t}\n\n\t\t\t// click\n\t\t\t//listen.call($li, \"click\", function(e) {\n\t\t\t//\tself.click(e);\n\t\t\t//});\n\n\t\t\t// status\n\t\t\tif (item.done) {\n\t\t\t\t$li.classList.add(\"-ok\");\n\t\t\t\t$li.classList.remove(\"-removed\");\n\t\t\t} else if (item.removed) {\n\t\t\t\t$li.classList.remove(\"-ok\");\n\t\t\t\t$li.classList.add(\"-removed\");\n\t\t\t} else {\n\t\t\t\t$li.classList.remove(\"-ok\");\n\t\t\t\t$li.classList.remove(\"-removed\");\n\t\t\t}\n\t\t});\n\t}\n\t// event\n\tinitEvents() {\n\t\tconst self = this;\n\n\t\tlisten.call(document.body, \"keydown\", (e)=>{\n\t\t\tconst keycode = e.keyCode;\n\t\t\tconst keyname = `${e.key}`.toLowerCase();\n\t\n\t\t\tif ( (keycode == 40 || keyname == 'arrowdown') || \n\t\t\t\t(keycode == 38 || keyname == 'arrowup')) \n\t\t\t{\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t\t\n\t\t\tself.keypress(e);\n\t\t\treturn false;\n\t\t});\n\t\tlisten.call(this.ul, \"click\", function(e){\n\t\t\tself.click(e);\n\t\t})\n\t}\n\tkeypress(e) {\n\t\tconst keycode = e.keyCode;\n\t\tconst keyname = `${e.key}`.toLowerCase();\n\t\t//console.log(keycode, keyname);\n\t\t\n\t\t// down\n\t\tif (keycode == 40 || keyname == 'arrowdown') {\n\t\t\tthis.moveToDown();\n\t\t}\n\t\t// up\n\t\tif (keycode == 38 || keyname == 'arrowup') {\n\t\t\tthis.moveToUp();\n\t\t}\n\t\t// delete\n\t\tif (keycode == 8 || keyname == \"backspace\") {\n\t\t\tthis.remove();\n\t\t}\n\t\t// enter\n\t\tif (keycode == 13 || keyname == 'enter') {\n\t\t\tthis.approve();\n\t\t}\n\t}\n\tclick(e) {\n\t\t// console.log(e);\n\t\tif (! e.path) {\n\t\t\treturn;\n\t\t}\n\t\tconst li = e.path.find(el_=>{\n\t\t\tif (el_.nodeType != Node.ELEMENT_NODE) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn (`${el_.nodeName}`.toLowerCase() == \"li\");\n\t\t});\n\t\t\n\t\tconst index = this.items.findIndex((item)=>{\n\t\t\treturn (item.$li == li);\n\t\t});\n\t\tif (index >= 0) {\n\t\t\tthis.current = index;\n\t\t}\n\n\t\tthis.update();\n\t\tthis.change();\n\t\t//this.scroll();\n\t}\n\tremove() {\n\t\tif (! Connection.isConnected()) {\n\t\t\tthis.moveToDown();\n\t\t\treturn;\n\t\t}\n\t\tif (typeof this.items[this.current] !== \"undefined\") {\n\t\t\tconst current = this.items[this.current];\n\n\t\t\t// already\n\t\t\tif (current.removed) {\n\t\t\t\tthis.update();\n\t\t\t\tthis.moveToDown();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcurrent.done = false;\n\t\t\tcurrent.removed = true;\n\n\t\t\tif (this.onupdate) {\n\t\t\t\tthis.onupdate(current);\n\t\t\t}\n\t\t\tConnection.connect((conn)=>{\n\t\t\t\tconn._request(\"/update\", \"POST\", {\n\t\t\t\t\t\"name\": current.name,\n\t\t\t\t\t\"src\" : current.path, \n\t\t\t\t\t\"action\" : \"remove\",\n\t\t\t\t}).then(res=>{\n\t\t\t\t\tres.json().then(data=>{\n\t\t\t\t\t\tif (data.dst) {\n\t\t\t\t\t\t\tcurrent.path = data.dst;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\tthis.update();\n\t\tthis.moveToDown();\n\t}\n\tapprove() {\n\t\tif (! Connection.isConnected()) {\n\t\t\tthis.moveToDown();\n\t\t\treturn;\n\t\t}\n\t\tif (typeof this.items[this.current] !== \"undefined\") {\n\t\t\tconst current = this.items[this.current];\n\t\t\t\n\t\t\t// already\n\t\t\tif (current.done) {\n\t\t\t\tthis.update();\n\t\t\t\tthis.moveToDown();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcurrent.done = true;\n\t\t\tcurrent.removed = false;\n\n\t\t\tif (this.onupdate) {\n\t\t\t\tthis.onupdate(current);\n\t\t\t}\n\t\t\tConnection.connect((conn)=>{\n\t\t\t\tconn._request(\"/update\", \"POST\", {\n\t\t\t\t\t\"name\": current.name,\n\t\t\t\t\t\"src\" : current.path, \n\t\t\t\t\t\"action\" : \"ok\",\n\t\t\t\t}).then(res=>{\n\t\t\t\t\tres.json().then(data=>{\n\t\t\t\t\t\tif (data.dst) {\n\t\t\t\t\t\t\tcurrent.path = data.dst;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.update();\n\t\tthis.moveToDown();\n\t}\n\tmoveToUp() {\n\t\tif (this.items.length <= 0) {\n\t\t\tthis.current = 0;\n\t\t} else {\n\t\t\t//this.current = (this.current + this.items.length - 1) % this.items.length;\n\t\t\tif (this.current > 0) this.current--;\n\t\t}\n\t\tthis.update();\n\t\tthis.change();\n\t\tthis.scroll();\n\t}\n\tmoveToDown() {\n\t\tif (this.items.length <= 0) {\n\t\t\tthis.current = 0;\n\t\t} else {\n\t\t\t// this.current = (this.current + 1) % this.items.length;\n\t\t\tif (this.current < this.items.length - 1) this.current++;\n\t\t}\n\t\tthis.update();\n\t\tthis.change();\n\t\tthis.scroll();\n\t}\n\tscroll() {\n\t\t//this.el;\n\t\tif (typeof this.items[this.current] !== \"undefined\") {\n\t\t\tlet scrollTop = this.el.scrollTop;\n\t\t\tconst height0 = this.el.clientHeight;\n\t\t\tconst innerHeight = this.el.querySelector(\"ul\").clientHeight;\n\t\t\tif (height0 - 24 > innerHeight) {\n\t\t\t\t//return;\n\t\t\t}\n\n\t\t\tconst current = this.items[this.current];\n\t\t\tconst rect = current.$li.getBoundingClientRect();\n\t\t\tconst top = rect.top;\n\t\t\tconst height = rect.height;\n\n\t\t\tconst top_ = (scrollTop + top) - (height0 - height)/2; // top should be\n\n\t\t\t//if (Math.abs(top - top_) > 24) {\n\t\t\t\tthis.el.scrollTo(0, top_);\n\t\t\t//}\n\t\t}\n\t}\n\n\tchange() {\n\t\tif (typeof this.items[this.current] !== \"undefined\") {\n\t\t\tif (this.onchange) {\n\t\t\t\tthis.onchange.call(this, this.items[this.current]);\n\t\t\t}\n\t\t}\n\t}\n\n}\nexport default Sources;\n","\n\nimport { listen, debug, setStyle } from './util';\nimport Preview from './preview';\nimport Sources from './sources';\nimport Connection from './connection';\n\n// reset events\nconst __return_false = ()=>false;\nlisten(\"wheel\", __return_false);\n//listen(\"click\", __return_false);\n//listen(\"mousedown\", __return_false);\n//listen(\"mousemove\", __return_false);\n//listen(\"mouseup\", __return_false);\n\n// connect\nConnection.connect((conn)=>{\n\tif (! conn) return;\n\n\tconn._request(\"/list\").then((res)=>{\n\t\tres.json().then(data=>{\n\t\t\tlet preview = null;\n\n\t\t\tconst s = new Sources(data[\"sources\"]);\n\t\t\ts.onchange = function(item) {\n\t\t\t\t// remount preview\n\t\t\t\tif (preview) {\n\t\t\t\t\tpreview.free();\n\t\t\t\t\tpreview = null;\n\t\t\t\t}\n\t\t\t\tpreview = new Preview(item);\n\t\t\t\tpreview.mount();\n\t\t\t};\n\t\t\ts.onupdate = function(item) {\n\t\t\t\t// item.removed\n\t\t\t\t// item.done\n\t\t\t}\n\t\t\ts.mount();\n\t\t});\n\t});\n});\n\n"],"names":["listen","name","callback","this","window","addEventListener","_debug","setAttrs","el","attrs","text","Object","keys","forEach","k","v","k_","style","Array","isArray","v_","classList","add","remove","split","trim","textContent","setStyle","styles","createElement","tagName","parentNode","document","appendChild","findByClass","q","elements","getElementsByClassName","length","image_data","imageUrl","path","reset","Preview","mode","startX","startY","pageX","pageY","imageX","imageY","_imageStartX","_imageStartY","zoom","image","frameImage","frame","bg","__mousedown","removeEventListener","__mousemove","__mouseup","Image","src","complete","onload","self_1","onerror","err","class","w0","clientWidth","h0","clientHeight","w","width","h","height","r","Math","min","frameWidth","frameHeight","frameX","frameY","update","initEvents","left","top","x","y","self","e","mousedown","mousemove","mouseup","call","_a","s","body","innerHTML","DATA_DIR","CONNECTION_URL","instance","mount","Connection","display","error","has_called","has_errored","done","setTimeout","req","_connect","_i","args","location","reload","apply","connected","_isLocal","_request","then","response","_this","showError","href","url","method","data","o","JSON","stringify","console","log","fetch","_path","indexOf","protocol","hostname","_observe","items","Sources","item","path_org","tag","removed","$image","push","mounted","ul","querySelector","change","index","$li","$item","current","keycode","keyCode","keyname","key","toLowerCase","preventDefault","stopPropagation","keypress","click","moveToDown","moveToUp","approve","li","find","el_","nodeType","Node","ELEMENT_NODE","nodeName","findIndex","isConnected","current_1","onupdate","connect","conn","action","res","json","dst","current_2","scroll","scrollTop","height0","rect","getBoundingClientRect","top_","scrollTo","onchange","preview","free"],"mappings":"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"}